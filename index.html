<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Fluent Now - AI Language Learning</title>
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <!-- CSS -->
  <script type="module">
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const m={Spanish:"español",French:"français",Italian:"italiano",German:"Deutsch",Portuguese:"português",Dutch:"Nederlands",Russian:"русский",Japanese:"日本語",Korean:"한국어","Chinese (Simplified)":"中文 (简体)",Arabic:"العربية",English:"English"},h={"flash-lite":"gemini-1.5-flash-8b-latest",flash:"gemini-1.5-flash-latest",pro:"gemini-1.5-pro-latest"},p={daily_life:["morning routine","grocery shopping","commuting to work","weekend activities","cooking dinner","cleaning house","watching TV","reading a book"],travel:["booking a hotel","at the airport","ordering food abroad","asking for directions","visiting museums","taking photos","meeting locals","exploring markets"],food:["cooking a meal","restaurant dining","street food adventure","baking desserts","farmers market visit","wine tasting","cooking with friends","trying new recipes"],friendship:["making new friends","planning together","helping each other","celebrating birthdays","weekend hangouts","sharing secrets","group activities","supporting friends"],work:["job interview","team meeting","office lunch","project deadline","networking event","presentation day","remote working","career change"],shopping:["clothing store visit","electronics shopping","market bargaining","online ordering","gift buying","window shopping","sales hunting","returning items"],health:["doctor visit","gym workout","healthy cooking","wellness routine","mental health care","medical checkup","fitness goals","stress management"],hobbies:["learning instrument","painting class","sports practice","reading club","photography walk","gardening time","crafting project","game night"],family:["family dinner","holiday gathering","helping parents","children playing","family vacation","visiting relatives","family traditions","home projects"],nature:["hiking adventure","beach day","camping trip","garden work","wildlife watching","mountain climbing","river rafting","nature photography"],technology:["learning new app","video call","social media","online learning","tech support","digital payments","smart home","cybersecurity"],education:["language class","study group","exam preparation","university life","skill development","online courses","library research","tutoring session"]},d={sourceLanguage:"Spanish",targetLanguage:"English",model:"flash-lite"};class y{constructor(e,t="flash-lite"){this.apiKey=e,this.model=t,this.baseUrl="https://generativelanguage.googleapis.com/v1beta/models"}setModel(e){this.model=e}getEndpoint(){const e=h[this.model];return`${this.baseUrl}/${e}:generateContent`}async makeRequest(e,t=null){var n,s,a,i,u;try{const c=[];t&&(c.push({role:"user",parts:[{text:t}]}),c.push({role:"model",parts:[{text:"I understand. I'll follow these instructions carefully."}]})),c.push({role:"user",parts:[{text:e}]});const o=await fetch(`${this.getEndpoint()}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:c,generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:2048}})});if(!o.ok){const g=await o.text();throw new Error(`API Error ${o.status}: ${g}`)}const l=await o.json();if(!((u=(i=(a=(s=(n=l.candidates)==null?void 0:n[0])==null?void 0:s.content)==null?void 0:a.parts)==null?void 0:i[0])!=null&&u.text))throw new Error("No content generated by API");return l.candidates[0].content.parts[0].text.trim()}catch(c){throw console.error("Gemini API Error:",c),new Error(`AI service error: ${c.message}`)}}async validateApiKey(){try{return await this.makeRequest('Hello, please respond with "API key validated"'),{valid:!0}}catch(e){return{valid:!1,error:e.message.includes("403")?"Invalid API key":"Connection failed"}}}async generateStory(e,t,n,s){const a="You are a language learning story generator. Generate stories that strictly adhere to CEFR language proficiency levels. Your stories must be educational, engaging, and precisely calibrated to the specified difficulty level.",i=`Write a short story in ${e} STRICTLY following ${t.toUpperCase()} CEFR level requirements:

STRICT CEFR ${t.toUpperCase()} REQUIREMENTS:
- VOCABULARY: ${this.getCEFRSpec(t,"vocabulary")}
- GRAMMAR: ${this.getCEFRSpec(t,"grammar")} 
- SENTENCES: ${this.getCEFRSpec(t,"sentences")}
- COMPLEXITY: ${this.getCEFRSpec(t,"complexity")}

Story theme: ${n} (specifically: ${s})

Requirements:
- Length: 100-150 words for ${t.toUpperCase()}
- Use ONLY vocabulary appropriate for ${t.toUpperCase()} level
- Use ONLY grammar structures appropriate for ${t.toUpperCase()} level
- Make it engaging and culturally appropriate
- Focus on everyday, relatable situations

Generate ONLY the story text, no additional commentary.`;return await this.makeRequest(i,a)}getCEFRSpec(e,t){var s;return((s={a1:{vocabulary:"High frequency words (most common 1000-1500 words), basic nouns, verbs, adjectives",grammar:"Present tense, simple past, basic sentence structures, no subordinate clauses",sentences:"Very short sentences (5-8 words average), simple subject-verb-object structure",complexity:"Single ideas per sentence, no complex connections between ideas, concrete situations only"},a2:{vocabulary:"Common words (2000-2500 words), routine activities, personal information, basic emotions",grammar:"Present, past, future tenses, basic modal verbs (can, must, should), simple conditionals",sentences:"Short sentences (8-12 words), some compound sentences with 'and', 'but', 'or'",complexity:"Simple connections between ideas, familiar topics, basic cause and effect"},b1:{vocabulary:"Extended vocabulary (3000-4000 words), abstract concepts, opinions, experiences",grammar:"All major tenses, conditional sentences, passive voice, relative clauses",sentences:"Medium length sentences (12-18 words), complex sentences with subordinate clauses",complexity:"Clear connections between ideas, arguments, hypothetical situations, past experiences"},b2:{vocabulary:"Wide vocabulary (4000-6000 words), specialized terms, nuanced expressions",grammar:"Advanced structures, subjunctive mood, complex conditionals, advanced passive constructions",sentences:"Longer sentences (15-25 words), sophisticated linking, varied sentence structures",complexity:"Abstract ideas, detailed arguments, implicit meanings, cultural references"},c1:{vocabulary:"Extensive vocabulary (6000+ words), idiomatic expressions, sophisticated terms",grammar:"All grammatical structures, subtle distinctions, stylistic variations",sentences:"Complex sentences (20+ words), sophisticated discourse markers, varied rhetorical devices",complexity:"Nuanced arguments, cultural subtleties, implicit meanings, sophisticated humor"}}[e.toLowerCase()])==null?void 0:s[t])||""}async translateText(e,t,n){const s=`Translate this ${t} text to ${n}. Provide only the translation, no explanations:

${e}`;return await this.makeRequest(s)}async rateTranslation(e,t,n,s,a){const i=`As a language teacher, evaluate this translation:

ORIGINAL (${s}): ${e}

STUDENT TRANSLATION (${a}): ${t}

REFERENCE TRANSLATION (${a}): ${n}

Provide detailed feedback in this format:
**Score: X/10**

**What you did well:**
- [positive points]

**Areas for improvement:**
- [specific issues with corrections]

**Key takeaways:**
- [important lessons]

Be encouraging but specific about errors.`;return await this.makeRequest(i)}async generateMiniLesson(e,t,n,s){const a=`Create a focused mini-lesson based on this translation attempt:

ORIGINAL (${n}): ${e}
STUDENT ATTEMPT (${s}): ${t}

Create a mini-lesson covering:
1. **Grammar Focus**: Main grammatical concepts
2. **Vocabulary**: Key words and their usage
3. **Practice**: 2-3 simple exercises

Keep it concise and practical.`;return await this.makeRequest(a)}async chat(e,t=null){let n=e;return t&&(n=`Context: ${t}

User question: ${e}`),await this.makeRequest(n,"You are a helpful language learning assistant. Answer questions about grammar, vocabulary, translations, and language learning. Be concise but informative. Use examples when helpful.")}}class f{constructor(e){this.geminiAPI=e,this.currentStory=null,this.referenceTranslation=null}setCurrentStory(e){this.currentStory=e,this.referenceTranslation=null}async processTranslation(e,t,n){if(!this.currentStory)throw new Error("No story available for translation");if(!e||e.trim().length===0)throw new Error("Please enter your translation before submitting");try{return this.referenceTranslation||(this.referenceTranslation=await this.geminiAPI.translateText(this.currentStory,t,n)),{feedback:await this.geminiAPI.rateTranslation(this.currentStory,e.trim(),this.referenceTranslation,t,n),referenceTranslation:this.referenceTranslation,userTranslation:e.trim()}}catch(s){throw console.error("Translation processing error:",s),new Error(`Failed to process translation: ${s.message}`)}}async generateMiniLesson(e,t,n){if(!this.currentStory||!e)throw new Error("Story and translation required for mini lesson");try{return await this.geminiAPI.generateMiniLesson(this.currentStory,e.trim(),t,n)}catch(s){throw console.error("Mini lesson generation error:",s),new Error(`Failed to generate lesson: ${s.message}`)}}displayFeedback(e,t){if(!e)return;const n=typeof marked<"u"&&marked.parse?marked.parse(t.feedback):t.feedback;e.innerHTML=`
            <div class="feedback-content">
                <div class="ai-feedback">
                    <h4>🎯 AI Feedback</h4>
                    ${n}
                </div>
                <div class="reference-translation">
                    <h4>📖 Reference Translation</h4>
                    <p><em>${t.referenceTranslation}</em></p>
                </div>
            </div>
        `,this.showResultsTabs("feedback")}displayMiniLesson(e){const t=document.getElementById("lesson-output");if(!t)return;const n=typeof marked<"u"&&marked.parse?marked.parse(e):e;t.innerHTML=`
            <div class="mini-lesson-content">
                <h4>📚 Mini Lesson</h4>
                ${n}
            </div>
        `,this.showResultsTabs("lesson")}clear(){this.currentStory=null,this.referenceTranslation=null}showTranslationSection(){const e=document.getElementById("translation-section"),t=document.getElementById("results-tabs");if(e){e.style.display="block";const n=document.getElementById("translation-input"),s=document.getElementById("feedback-output"),a=document.getElementById("lesson-output"),i=document.getElementById("mini-lesson-btn");n&&(n.value=""),s&&(s.innerHTML="",s.classList.remove("has-content")),a&&(a.innerHTML=""),i&&(i.style.display="none"),t&&(t.style.display="none")}}hideTranslationSection(){const e=document.getElementById("translation-section");e&&(e.style.display="none")}showResultsTabs(e="feedback"){const t=document.getElementById("results-tabs");if(t){t.style.display="block",this.switchTab(e);const n=document.getElementById("mini-lesson-btn");n&&(n.style.display="inline-block")}}switchTab(e){const t=document.getElementById("feedback-tab"),n=document.getElementById("lesson-tab");t&&n&&(t.classList.toggle("active",e==="feedback"),n.classList.toggle("active",e==="lesson"));const s=document.getElementById("feedback-tab-content"),a=document.getElementById("lesson-tab-content");s&&a&&(s.classList.toggle("active",e==="feedback"),a.classList.toggle("active",e==="lesson"));const i=document.getElementById("results-tabs");i&&i.scrollIntoView({behavior:"smooth",block:"nearest"})}}class b{constructor(e){this.geminiAPI=e,this.chatHistory=[],this.isOpen=!1,this.context=null}setContext(e){this.context=e}toggleChat(){const e=document.getElementById("chat-container"),t=document.getElementById("chat-toggle");if(!(!e||!t)&&(this.isOpen=!this.isOpen,e.style.display=this.isOpen?"block":"none",t.textContent=this.isOpen?"✕":"💬",this.isOpen)){const n=document.getElementById("chat-input");n&&setTimeout(()=>n.focus(),100)}}async sendMessage(e){if(!e||e.trim().length===0)return;const t=e.trim();try{this.addMessageToChat(t,"user");const n=document.getElementById("chat-input");n&&(n.value=""),this.showTypingIndicator();const s=await this.geminiAPI.chat(t,this.context);this.hideTypingIndicator(),this.addMessageToChat(s,"bot"),this.chatHistory.push({role:"user",message:t},{role:"bot",message:s})}catch(n){this.hideTypingIndicator(),this.addMessageToChat("Sorry, I encountered an error. Please try again.","bot"),console.error("Chat error:",n)}}addMessageToChat(e,t){const n=document.getElementById("chat-messages");if(!n)return;const s=document.createElement("div");s.classList.add("chat-message",`${t}-message`),t==="bot"?s.innerHTML=typeof marked<"u"&&marked.parse?marked.parse(e):e:s.textContent=e,n.appendChild(s),n.scrollTop=n.scrollHeight}showTypingIndicator(){const e=document.getElementById("chat-messages");if(!e)return;const t=document.createElement("div");t.classList.add("chat-message","bot-message","typing-indicator"),t.innerHTML='<span class="typing-dots">●●●</span>',t.id="typing-indicator",e.appendChild(t),e.scrollTop=e.scrollHeight}hideTypingIndicator(){const e=document.getElementById("typing-indicator");e&&e.remove()}handleKeyPress(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();const t=e.target;this.sendMessage(t.value)}}clearChat(){this.chatHistory=[];const e=document.getElementById("chat-messages");e&&(e.innerHTML="")}initializeChat(){this.addMessageToChat(`Hello! I'm your AI language learning assistant. I can help you with:

• Grammar questions
• Vocabulary explanations
• Translation help
• Language learning tips

What would you like to know?`,"bot")}updateContextWithStory(e,t,n){this.context={currentStory:e,sourceLanguage:t,targetLanguage:n,timestamp:Date.now()}}closeChat(){this.isOpen&&this.toggleChat()}}function v(r){const e=p[r];return!e||e.length===0?"general situation":e[Math.floor(Math.random()*e.length)]}function I(r){return{daily_life:"Daily Life",travel:"Travel & Adventure",food:"Food & Cooking",friendship:"Friendship & Relationships",work:"Work & Career",shopping:"Shopping & Money",health:"Health & Wellness",hobbies:"Hobbies & Entertainment",family:"Family & Home",nature:"Nature & Environment",technology:"Technology & Modern Life",education:"Education & Learning",custom:"Custom Theme"}[r]||r}function E(r){if(!r||typeof r!="string")return{valid:!1,error:"Custom theme is required"};const e=r.trim();return e.length<3?{valid:!1,error:"Custom theme must be at least 3 characters"}:e.length>100?{valid:!1,error:"Custom theme must be less than 100 characters"}:{valid:!0,theme:e}}function w(r,e=null){if(r==="custom"){const t=E(e);if(!t.valid)throw new Error(t.error);return{theme:t.theme,variant:"custom story scenario"}}return{theme:I(r),variant:v(r)}}class k{constructor(){this.currentStory=null,this.sourceLanguage=d.sourceLanguage,this.targetLanguage=d.targetLanguage,this.apiKey=null,this.selectedModel=d.model,this.geminiAPI=null,this.translationManager=null,this.chatManager=null}async initialize(){console.log("🚀 Initializing Get Fluent Now App..."),this.setupEventListeners();const e=localStorage.getItem("gemini_api_key");e?(document.getElementById("gemini-api-key").value=e,await this.validateApiKey()):this.updateStatus("🔑 Please enter your Gemini API key to enable AI features"),document.getElementById("app-controls").style.display="block",this.initializeThemeSelector()}setupEventListeners(){const e=document.getElementById("story-theme");e&&e.addEventListener("change",()=>this.handleThemeChange());const t=document.getElementById("chat-input");t&&t.addEventListener("keypress",i=>this.handleChatKeyPress(i));const n=document.getElementById("source-lang"),s=document.getElementById("target-lang");n&&n.addEventListener("change",()=>this.updateLanguages()),s&&s.addEventListener("change",()=>this.updateLanguages()),document.querySelectorAll('input[name="model"]').forEach(i=>{i.addEventListener("change",()=>this.updateModel())})}initializeThemeSelector(){const e=document.getElementById("story-theme"),t=document.getElementById("custom-theme-container");e&&t&&(t.style.display=e.value==="custom"?"block":"none")}updateStatus(e){const t=document.getElementById("status");t&&(t.textContent=e)}async validateApiKey(){const e=document.getElementById("gemini-api-key");if(!e)return;const t=e.value.trim();if(!t){this.updateStatus("❌ Please enter your Gemini API key");return}this.updateStatus("🔄 Validating API key...");try{const n=new y(t,this.selectedModel),s=await n.validateApiKey();s.valid?(this.apiKey=t,localStorage.setItem("gemini_api_key",t),this.geminiAPI=n,this.translationManager=new f(this.geminiAPI),this.chatManager=new b(this.geminiAPI),this.chatManager.initializeChat(),this.updateStatus("✅ API key validated! Ready to generate stories")):this.updateStatus(`❌ ${s.error}`)}catch(n){console.error("API validation error:",n),this.updateStatus("❌ Failed to validate API key")}}updateModel(){const e=document.querySelectorAll('input[name="model"]');for(const t of e)if(t.checked&&this.geminiAPI){this.selectedModel=t.value,this.geminiAPI.setModel(this.selectedModel);break}}updateLanguages(){const e=document.getElementById("source-lang"),t=document.getElementById("target-lang");if(e&&t){if(this.sourceLanguage=e.value,this.targetLanguage=t.value,this.sourceLanguage===this.targetLanguage){this.updateStatus("⚠️ Source and target languages must be different");return}this.currentStory&&this.chatManager&&this.chatManager.updateContextWithStory(this.currentStory,this.sourceLanguage,this.targetLanguage)}}swapLanguages(){const e=document.getElementById("source-lang"),t=document.getElementById("target-lang");if(e&&t){const n=e.value;e.value=t.value,t.value=n,this.updateLanguages()}}handleThemeChange(){const e=document.getElementById("story-theme"),t=document.getElementById("custom-theme-container");if(e&&t){const n=e.value==="custom";if(t.style.display=n?"block":"none",n){const s=document.getElementById("custom-theme-input");s&&s.focus()}}}async generateStory(){if(!this.geminiAPI){this.updateStatus("❌ Please validate your API key first");return}const e=document.getElementById("difficulty-level"),t=document.getElementById("story-theme"),n=document.getElementById("custom-theme-input"),s=document.getElementById("story-output"),a=document.getElementById("generate-story-btn");if(!e||!t||!s||!a)return;const i=e.value,u=t.value,c=n?n.value:null;try{a.textContent="⏳ Generating...",a.disabled=!0,s.textContent="Generating your story...",this.updateStatus("✨ Generating story...");const o=w(u,c),l=await this.geminiAPI.generateStory(m[this.sourceLanguage],i,o.theme,o.variant);this.currentStory=l,s.textContent=l,s.classList.add("has-content"),this.translationManager.setCurrentStory(l),this.translationManager.showTranslationSection(),this.chatManager.updateContextWithStory(l,this.sourceLanguage,this.targetLanguage),this.updateStatus("✅ Story generated! Translate it to practice")}catch(o){console.error("Story generation error:",o),this.updateStatus("❌ Failed to generate story"),s.textContent=`Error: ${o.message}`}finally{a.textContent="✨ Generate New Story",a.disabled=!1}}async submitTranslation(){if(!this.translationManager){this.updateStatus("❌ Translation manager not initialized");return}const e=document.getElementById("translation-input"),t=document.getElementById("submit-translation-btn"),n=document.getElementById("feedback-output"),s=document.getElementById("mini-lesson-btn");if(!e||!t||!n)return;const a=e.value.trim();try{t.textContent="⏳ Getting feedback...",t.disabled=!0,n.textContent="Analyzing your translation...",this.updateStatus("🔍 Analyzing your translation...");const i=await this.translationManager.processTranslation(a,this.sourceLanguage,this.targetLanguage);this.translationManager.displayFeedback(n,i),s&&(s.style.display="inline-block"),this.updateStatus("✅ Feedback provided! Check your translation")}catch(i){console.error("Translation submission error:",i),this.updateStatus("❌ Failed to process translation"),n.textContent=`Error: ${i.message}`}finally{t.textContent="🎯 Get Feedback",t.disabled=!1}}async generateMiniLesson(){if(!this.translationManager)return;const e=document.getElementById("translation-input"),t=document.getElementById("feedback-output"),n=document.getElementById("mini-lesson-btn");if(!e||!t)return;const s=e.value.trim();try{n&&(n.textContent="⏳ Creating lesson...",n.disabled=!0),this.updateStatus("📚 Creating personalized lesson...");const a=await this.translationManager.generateMiniLesson(s,this.sourceLanguage,this.targetLanguage);this.translationManager.displayMiniLesson(a),this.updateStatus("✅ Mini lesson ready!")}catch(a){console.error("Mini lesson error:",a),this.updateStatus("❌ Failed to generate lesson")}finally{n&&(n.textContent="📚 Mini Lesson",n.disabled=!1)}}toggleChat(){this.chatManager&&this.chatManager.toggleChat()}async sendChatMessage(){if(!this.chatManager)return;const e=document.getElementById("chat-input");e&&await this.chatManager.sendMessage(e.value)}handleChatKeyPress(e){this.chatManager&&this.chatManager.handleKeyPress(e)}showApiHelp(){const e=document.getElementById("help-modal");e&&(e.style.display="flex")}closeApiHelp(){const e=document.getElementById("help-modal");e&&(e.style.display="none")}switchTab(e){this.translationManager&&this.translationManager.switchTab(e)}}document.addEventListener("DOMContentLoaded",()=>{window.app=new k,window.app.initialize()});

</script>
  <style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1.6;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;color:#333}#main-container{max-width:900px;margin:0 auto;padding:20px;min-height:100vh}#header{text-align:center;margin-bottom:30px;color:#fff}#main-title{font-size:2.5rem;font-weight:700;margin-bottom:10px;text-shadow:0 2px 4px rgba(0,0,0,.3)}#subtitle{font-size:1.1rem;opacity:.9;font-weight:300}.section-card{background:#fff;border-radius:12px;padding:25px;margin-bottom:20px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}#status{background:#fff;padding:15px 20px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:500;border:2px solid #e5e7eb}#api-section{background:#fff;border-radius:12px;padding:25px;margin-bottom:20px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}#api-input-container{display:flex;gap:10px;align-items:center;flex-wrap:wrap}#gemini-api-key{flex:1;min-width:250px;padding:12px 15px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;background:#f9fafb}#gemini-api-key:focus{outline:none;border-color:#667eea;background:#fff}button{padding:12px 20px;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;white-space:nowrap}#validate-key-btn,#generate-story-btn,#submit-translation-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}#validate-key-btn:hover,#generate-story-btn:hover,#submit-translation-btn:hover{background:linear-gradient(135deg,#5a6fd8,#6a4190);transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}#help-btn,#swap-languages,#mini-lesson-btn{background:#f3f4f6;color:#374151;border:2px solid #e5e7eb}#help-btn:hover,#swap-languages:hover,#mini-lesson-btn:hover{background:#e5e7eb;border-color:#d1d5db}#swap-languages{margin-top:20px;width:100%;font-size:15px;padding:15px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;box-shadow:0 2px 4px #667eea4d}#swap-languages:hover{background:linear-gradient(135deg,#5a6fd8,#6a4190);transform:translateY(-1px);box-shadow:0 4px 8px #667eea66}#app-controls{display:grid;gap:20px}#model-section,#difficulty-section,#theme-section,#language-section{background:#fff;border-radius:12px;padding:25px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}#language-controls{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:10px}h3{margin-bottom:15px;color:#374151;font-size:1.1rem;font-weight:600}label{display:block;margin-bottom:8px;font-weight:500;color:#374151}select{width:100%;padding:12px 15px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;background:#fff;color:#374151;cursor:pointer}select:focus{outline:none;border-color:#667eea}#model-options{display:flex;flex-direction:row;gap:15px;flex-wrap:wrap}.radio-option{display:flex;align-items:center;padding:12px 16px;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;transition:all .2s;background:#f9fafb;flex:1;min-width:140px;justify-content:center;text-align:center}.radio-option:hover{border-color:#d1d5db;background:#f3f4f6}.radio-option input[type=radio]{margin-right:8px;accent-color:#667eea;cursor:pointer}.radio-option input[type=radio]:checked+.radio-label{color:#374151;font-weight:600}.radio-option:has(input:checked){border-color:#667eea;background:#f0f9ff}.radio-label{display:flex;flex-direction:column;gap:2px;font-size:13px}.radio-label strong{color:#374151;font-size:13px;font-weight:600}.radio-label small{color:#6b7280;font-size:11px;font-weight:400}#custom-theme-input{width:100%;padding:12px 15px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;margin-top:10px;background:#f9fafb}#custom-theme-input:focus{outline:none;border-color:#667eea;background:#fff}#story-section{background:#fff;border-radius:12px;padding:25px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}#generate-story-btn{width:100%;font-size:16px;padding:15px;margin-bottom:20px}#story-output{background:#f8fafc;border:2px solid #e2e8f0;border-radius:8px;padding:20px;margin-top:15px;font-size:16px;line-height:1.8;color:#2d3748;min-height:100px}#story-output.has-content{background:#fff;border-color:#667eea}#translation-section{background:#fff;border-radius:12px;padding:25px;box-shadow:0 4px 6px #0000001a;border:1px solid #e5e7eb}#translation-input{width:100%;padding:15px;border:2px solid #e5e7eb;border-radius:8px;font-size:16px;line-height:1.6;resize:vertical;font-family:inherit;margin-bottom:15px}#translation-input:focus{outline:none;border-color:#667eea}#translation-controls{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:20px}#feedback-output{background:#f8fafc;border:2px solid #e2e8f0;border-radius:8px;padding:20px;margin-top:15px;line-height:1.6}#feedback-output.has-content{background:#fff;border-color:#10b981}#feedback-output h1,#feedback-output h2,#feedback-output h3,#feedback-output h4,#feedback-output h5,#feedback-output h6{color:#374151;margin:20px 0 12px;font-weight:600;line-height:1.3}#feedback-output h1{font-size:1.8rem}#feedback-output h2{font-size:1.5rem}#feedback-output h3{font-size:1.3rem}#feedback-output h4{font-size:1.1rem}#feedback-output h5{font-size:1rem}#feedback-output h6{font-size:.9rem}#feedback-output p{margin:12px 0;line-height:1.6}#feedback-output ul,#feedback-output ol{margin:12px 0 12px 20px;line-height:1.6}#feedback-output li{margin:6px 0}#feedback-output strong{font-weight:600;color:#374151}#feedback-output em{font-style:italic;color:#6b7280}#feedback-output code{background:#f3f4f6;padding:2px 6px;border-radius:4px;font-family:SF Mono,Monaco,Cascadia Code,monospace;font-size:.9em}#feedback-output blockquote{border-left:4px solid #e5e7eb;margin:16px 0;padding:8px 16px;background:#f9fafb;font-style:italic}#results-tabs{margin-top:20px}#tab-buttons{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:0;gap:0}.tab-button{padding:12px 20px;border:none;border-bottom:3px solid transparent;background:#f9fafb;color:#6b7280;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;border-radius:8px 8px 0 0;margin-right:4px}.tab-button:hover{background:#f3f4f6;color:#374151}.tab-button.active{background:#fff;color:#667eea;border-bottom-color:#667eea;font-weight:600}#tab-content{background:#fff;border:2px solid #e5e7eb;border-top:none;border-radius:0 0 8px 8px;min-height:200px}.tab-panel{display:none;padding:20px}.tab-panel.active{display:block}#feedback-output,#lesson-output{background:transparent;border:none;padding:0;margin:0;min-height:auto}#lesson-output h1,#lesson-output h2,#lesson-output h3,#lesson-output h4,#lesson-output h5,#lesson-output h6{color:#374151;margin:20px 0 12px;font-weight:600;line-height:1.3}#lesson-output h1{font-size:1.8rem}#lesson-output h2{font-size:1.5rem}#lesson-output h3{font-size:1.3rem}#lesson-output h4{font-size:1.1rem}#lesson-output h5{font-size:1rem}#lesson-output h6{font-size:.9rem}#lesson-output p{margin:12px 0;line-height:1.6}#lesson-output ul,#lesson-output ol{margin:12px 0 12px 20px;line-height:1.6}#lesson-output li{margin:6px 0}#lesson-output strong{font-weight:600;color:#374151}#lesson-output em{font-style:italic;color:#6b7280}#lesson-output code{background:#f3f4f6;padding:2px 6px;border-radius:4px;font-family:SF Mono,Monaco,Cascadia Code,monospace;font-size:.9em}#lesson-output blockquote{border-left:4px solid #e5e7eb;margin:16px 0;padding:8px 16px;background:#f9fafb;font-style:italic}#chat-widget{position:fixed;bottom:30px;right:30px;z-index:1000}#chat-toggle{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;box-shadow:0 4px 12px #00000026;transition:all .3s}#chat-toggle:hover{transform:scale(1.1);box-shadow:0 6px 20px #0003}#chat-container{position:absolute;bottom:80px;right:0;width:350px;height:400px;background:#fff;border-radius:12px;box-shadow:0 8px 25px #00000026;display:flex;flex-direction:column;border:1px solid #e5e7eb}#chat-header{padding:15px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:12px 12px 0 0;display:flex;justify-content:space-between;align-items:center}#chat-header h4{margin:0;font-size:16px}#chat-close{background:#fff3;border:none;color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px}#chat-messages{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px}.chat-message{max-width:80%;padding:10px 15px;border-radius:12px;line-height:1.4;font-size:14px}.user-message{background:#667eea;color:#fff;align-self:flex-end;border-bottom-right-radius:4px}.bot-message{background:#f3f4f6;color:#374151;align-self:flex-start;border-bottom-left-radius:4px}#chat-input-container{padding:15px;border-top:1px solid #e5e7eb;display:flex;gap:10px}#chat-input{flex:1;padding:10px 12px;border:1px solid #e5e7eb;border-radius:20px;font-size:14px;outline:none}#chat-input:focus{border-color:#667eea}#chat-send-btn{padding:10px 15px;background:#667eea;color:#fff;border:none;border-radius:20px;cursor:pointer;font-size:14px}#help-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000b3;z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px}#help-content{background:#fff;border-radius:12px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 40px #00000026}#help-header{padding:25px 25px 15px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center}#help-header h2{margin:0;color:#374151;font-size:1.5rem}#close-help{background:#f3f4f6;border:none;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:18px;color:#6b7280}#help-steps{padding:25px}.help-step{margin-bottom:25px}.help-step h3{color:#667eea;margin-bottom:8px;font-size:1.1rem}.help-step p{color:#6b7280;margin-bottom:5px}.help-step a{color:#667eea;text-decoration:none;font-weight:500}.help-step a:hover{text-decoration:underline}.help-note{background:#f0f9ff;border:1px solid #e0f2fe;border-radius:8px;padding:15px;margin-top:20px}.help-note p{color:#0369a1;margin-bottom:5px;font-size:14px}@media (max-width: 768px){#main-container{padding:15px}#main-title{font-size:2rem}#language-controls{grid-template-columns:1fr;gap:15px}#api-input-container{flex-direction:column;align-items:stretch}#gemini-api-key{min-width:unset}#translation-controls{flex-direction:column}#model-options{flex-direction:column;gap:10px}.radio-option{min-width:unset;justify-content:flex-start}#chat-container{width:calc(100vw - 40px);right:-15px;height:350px}#chat-widget{right:20px;bottom:20px}#help-content{margin:10px;max-height:90vh}}@media (max-width: 480px){#main-container{padding:10px}.section-card,#api-section,#model-section,#language-section,#difficulty-section,#theme-section,#story-section,#translation-section{padding:20px}#main-title{font-size:1.8rem}#subtitle{font-size:1rem}}

</style>
</head>
<body>
    <!-- Main Container -->
    <div id="main-container">
        <!-- Header Section -->
        <div id="header">
            <h1 id="main-title">Get Fluent Now 🌍</h1>
            <p id="subtitle">AI-powered language learning with Google Gemini</p>
        </div>

        <!-- Status Display -->
        <div id="status">🔑 Please enter your Gemini API key to enable AI chat</div>

        <!-- API Key Configuration -->
        <div id="api-section">
            <div id="api-input-container">
                <input 
                    type="password" 
                    id="gemini-api-key" 
                    placeholder="Enter your Gemini API key" 
                    autocomplete="off"
                >
                <button id="validate-key-btn" onclick="app.validateApiKey()">Validate Key</button>
                <button id="help-btn" onclick="app.showApiHelp()">❓ Get API Key</button>
            </div>
        </div>

        <!-- App Controls -->
        <div id="app-controls" style="display: none;">
            <!-- Model Selection -->
            <div id="model-section">
                <h3>🧠 AI Model</h3>
                <div id="model-options">
                    <label class="radio-option">
                        <input type="radio" name="model" value="flash-lite" checked onchange="app.updateModel()">
                        <span class="radio-label">
                            <strong>Gemini 1.5 Flash 8B</strong>
                            <small>Fastest, most cost-effective</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="model" value="flash" onchange="app.updateModel()">
                        <span class="radio-label">
                            <strong>Gemini 1.5 Flash</strong>
                            <small>Balanced speed and quality</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="model" value="pro" onchange="app.updateModel()">
                        <span class="radio-label">
                            <strong>Gemini 1.5 Pro</strong>
                            <small>Highest quality, slower</small>
                        </span>
                    </label>
                </div>
            </div>

            <!-- Language Configuration -->
            <div id="language-section">
                <div id="language-controls">
                    <div id="source-lang-control">
                        <label for="source-lang">📚 Story Language:</label>
                        <select id="source-lang" onchange="app.updateLanguages()">
                            <option value="Spanish">Spanish (español)</option>
                            <option value="French">French (français)</option>
                            <option value="Italian">Italian (italiano)</option>
                            <option value="German">German (Deutsch)</option>
                            <option value="Portuguese">Portuguese (português)</option>
                            <option value="Dutch">Dutch (Nederlands)</option>
                            <option value="Russian">Russian (русский)</option>
                            <option value="Japanese">Japanese (日本語)</option>
                            <option value="Korean">Korean (한국어)</option>
                            <option value="Chinese (Simplified)">Chinese (中文)</option>
                            <option value="Arabic">Arabic (العربية)</option>
                            <option value="English">English</option>
                        </select>
                    </div>
                    <div id="target-lang-control">
                        <label for="target-lang">🎯 Translate to:</label>
                        <select id="target-lang" onchange="app.updateLanguages()">
                            <option value="English">English</option>
                            <option value="Spanish">Spanish (español)</option>
                            <option value="French">French (français)</option>
                            <option value="Italian">Italian (italiano)</option>
                            <option value="German">German (Deutsch)</option>
                            <option value="Portuguese">Portuguese (português)</option>
                            <option value="Dutch">Dutch (Nederlands)</option>
                            <option value="Russian">Russian (русский)</option>
                            <option value="Japanese">Japanese (日本語)</option>
                            <option value="Korean">Korean (한국어)</option>
                            <option value="Chinese (Simplified)">Chinese (中文)</option>
                            <option value="Arabic">Arabic (العربية)</option>
                        </select>
                    </div>
                </div>
                <button id="swap-languages" onclick="app.swapLanguages()">🔄 Swap Languages</button>
            </div>

            <!-- Difficulty Level -->
            <div id="difficulty-section">
                <h3>📊 Difficulty Level (CEFR)</h3>
                <select id="difficulty-level">
                    <option value="A1">A1 - Complete Beginner</option>
                    <option value="A2">A2 - Elementary</option>
                    <option value="B1">B1 - Intermediate</option>
                    <option value="B2">B2 - Upper Intermediate</option>
                    <option value="C1">C1 - Advanced</option>
                </select>
            </div>

            <!-- Theme Selection -->
            <div id="theme-section">
                <h3>🎨 Story Theme</h3>
                <select id="story-theme">
                    <option value="daily_life">Daily Life</option>
                    <option value="travel">Travel & Adventure</option>
                    <option value="food">Food & Cooking</option>
                    <option value="friendship">Friendship & Relationships</option>
                    <option value="work">Work & Career</option>
                    <option value="shopping">Shopping & Money</option>
                    <option value="health">Health & Wellness</option>
                    <option value="hobbies">Hobbies & Entertainment</option>
                    <option value="family">Family & Home</option>
                    <option value="nature">Nature & Environment</option>
                    <option value="technology">Technology & Modern Life</option>
                    <option value="education">Education & Learning</option>
                    <option value="custom">Custom Theme</option>
                </select>
                <div id="custom-theme-container" style="display: none;">
                    <input 
                        type="text" 
                        id="custom-theme-input" 
                        placeholder="Describe your custom story theme..."
                    >
                </div>
            </div>

            <!-- Story Generation -->
            <div id="story-section">
                <button id="generate-story-btn" onclick="app.generateStory()">
                    ✨ Generate New Story
                </button>
                <div id="story-output"></div>
            </div>

            <!-- Translation Section -->
            <div id="translation-section" style="display: none;">
                <h3>🔤 Your Translation</h3>
                <textarea 
                    id="translation-input" 
                    placeholder="Type your translation here..."
                    rows="4"
                ></textarea>
                <div id="translation-controls">
                    <button id="submit-translation-btn" onclick="app.submitTranslation()">
                        🎯 Get Feedback
                    </button>
                    <button id="mini-lesson-btn" onclick="app.generateMiniLesson()" style="display: none;">
                        📚 Generate Mini Lesson
                    </button>
                </div>
                
                <!-- Results Tabs -->
                <div id="results-tabs" style="display: none;">
                    <div id="tab-buttons">
                        <button id="feedback-tab" class="tab-button active" onclick="app.switchTab('feedback')">
                            🎯 Feedback
                        </button>
                        <button id="lesson-tab" class="tab-button" onclick="app.switchTab('lesson')">
                            📚 Mini Lesson
                        </button>
                    </div>
                    <div id="tab-content">
                        <div id="feedback-tab-content" class="tab-panel active">
                            <div id="feedback-output"></div>
                        </div>
                        <div id="lesson-tab-content" class="tab-panel">
                            <div id="lesson-output"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Chat Widget -->
        <div id="chat-widget">
            <div id="chat-toggle" onclick="app.toggleChat()">💬</div>
            <div id="chat-container" style="display: none;">
                <div id="chat-header">
                    <h4>🤖 AI Assistant</h4>
                    <button id="chat-close" onclick="app.toggleChat()">×</button>
                </div>
                <div id="chat-messages"></div>
                <div id="chat-input-container">
                    <input 
                        type="text" 
                        id="chat-input" 
                        placeholder="Ask about grammar, vocabulary, or translations..."
                        onkeypress="app.handleChatKeyPress(event)"
                    >
                    <button id="chat-send-btn" onclick="app.sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Help Modal -->
    <div id="help-modal" style="display: none;">
        <div id="help-content">
            <div id="help-header">
                <h2>🔑 Get Your Free Google Gemini API Key</h2>
                <button id="close-help" onclick="app.closeApiHelp()">×</button>
            </div>
            <div id="help-steps">
                <div class="help-step">
                    <h3>Step 1: Visit Google AI Studio</h3>
                    <p>Go to <a href="https://ai.google.dev/gemini-api/docs/api-key" target="_blank">ai.google.dev/gemini-api/docs/api-key</a></p>
                </div>
                <div class="help-step">
                    <h3>Step 2: Sign in</h3>
                    <p>Sign in with your Google account (it's free!)</p>
                </div>
                <div class="help-step">
                    <h3>Step 3: Create API Key</h3>
                    <p>Click "Get API key" → "Create API key in new project"</p>
                </div>
                <div class="help-step">
                    <h3>Step 4: Copy & Paste</h3>
                    <p>Copy the API key and paste it into the input field above</p>
                </div>
                <div class="help-note">
                    <p><strong>✅ Free tier includes:</strong> 15 requests per minute, 1 million tokens per day</p>
                    <p><strong>🔒 Privacy:</strong> Your API key is stored locally in your browser only</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
</body>
</html>